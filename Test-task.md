# Техническое задание: ML-инженер для системы рекомендаций

## Описание проекта

Разработать ML-модель для предсказания следующей покупки пользователя и следующего товара, который он купит, на основе исторических данных о продажах ювелирных изделий.

## Анализ датасета

### Структура данных
- **Объем**: 39,480 записей о продажах
- **Период**: 2024-2025 гг.
- **Уникальных клиентов**: ~18,000
- **Уникальных товаров**: ~15,000
- **Колонки**:
  - `FirstName`, `FullName` - имена клиентов (обезличены)
  - `phone` - номера телефонов (обезличены)
  - `town` - город (АСТАНА)
  - `countPoints` - бонусные баллы клиента
  - `Item` - товар (ювелирные изделия)
  - `Date` - дата покупки
  - `Price` - цена товара
  - `Format` - формат продажи (Оффлайн, Трейд Ин)

### Характеристики товаров
- Ювелирные изделия (серьги, кольца, цепи)
- Материалы: Ag 925 (серебро), Au 585 (золото)
- Ценовой диапазон: от 1,490 до 1,083,500 тенге
- Средняя цена: ~50,000 тенге

## Задачи ML-модели

### 1. Предсказание следующей покупки
**Цель**: Определить, когда клиент совершит следующую покупку

**Входные данные**:
- История покупок клиента
- Временные интервалы между покупками
- Сезонность покупок
- Сумма и количество предыдущих покупок
- Бонусные баллы клиента

**Выходные данные**:
- Вероятность покупки в следующие N дней (7, 14, 30, 60, 90)
- Предполагаемая дата следующей покупки

### 2. Предсказание следующего товара
**Цель**: Определить, какой товар клиент купит следующим

**Входные данные**:
- История покупок клиента
- Категории и типы ранее купленных товаров
- Ценовые предпочтения
- Сезонные паттерны покупок
- Популярность товаров

**Выходные данные**:
- Топ-K рекомендованных товаров
- Вероятность покупки каждого товара
- Ранжированный список рекомендаций

## Метрики качества

### Для предсказания времени покупки
1. **Precision@K** - точность предсказания в топ-K дней
2. **Recall@K** - полнота предсказания в топ-K дней
3. **F1-Score** - гармоническое среднее precision и recall
4. **Mean Absolute Error (MAE)** - средняя абсолютная ошибка в днях
5. **Root Mean Square Error (RMSE)** - корень из среднеквадратичной ошибки
6. **Hit Rate** - процент клиентов, для которых предсказание сбылось в заданном окне

### Для предсказания товара
1. **Precision@K** - точность в топ-K рекомендаций
2. **Recall@K** - полнота в топ-K рекомендаций
3. **NDCG@K** - Normalized Discounted Cumulative Gain
4. **MAP@K** - Mean Average Precision
5. **Hit Rate@K** - процент клиентов, купивших хотя бы один из рекомендованных товаров
6. **Coverage** - процент товаров из каталога, которые модель может рекомендовать

### Бизнес-метрики
1. **Conversion Rate** - конверсия рекомендаций в покупки
2. **Revenue Lift** - прирост выручки от рекомендаций
3. **Customer Retention** - удержание клиентов
4. **Average Order Value** - средний чек

## Подходы к решению

### 1. Для предсказания времени покупки
- **Survival Analysis** (Cox Proportional Hazards)
- **Time Series Forecasting** (ARIMA, Prophet, LSTM)
- **Classification** (Random Forest, XGBoost, Neural Networks)
- **Collaborative Filtering** с временными факторами

### 2. Для предсказания товара
- **Collaborative Filtering** (User-based, Item-based)
- **Matrix Factorization** (SVD, NMF, ALS)
- **Deep Learning** (Neural Collaborative Filtering, Autoencoders)
- **Hybrid Approaches** (Content + Collaborative)
- **Sequential Models** (RNN, LSTM, GRU, Transformer)

## Технические требования

### Данные для обучения
- **Train set**: 70% данных (до 2024-10-01)
- **Validation set**: 15% данных (2024-10-01 - 2024-12-31)
- **Test set**: 15% данных (2025-01-01+)

### Feature Engineering
1. **Временные признаки**:
   - Дни с последней покупки
   - Сезонность (месяц, квартал)
   - День недели покупки
   - Праздничные дни

2. **Поведенческие признаки**:
   - Частота покупок
   - Средний чек
   - Любимые категории товаров
   - Ценовые предпочтения

3. **Товарные признаки**:
   - Категория товара
   - Материал (Ag, Au)
   - Ценовой сегмент
   - Популярность товара

### Валидация модели
- **Time-based split** - разделение по времени
- **User-based split** - разделение по клиентам
- **Cross-validation** с учетом временных рядов
- **A/B тестирование** на реальных данных

## Ожидаемые результаты

### Минимальные требования
- Precision@5 для времени покупки: > 0.3
- Precision@10 для товаров: > 0.2
- Hit Rate@10 для товаров: > 0.15

### Целевые показатели
- Precision@5 для времени покупки: > 0.5
- Precision@10 для товаров: > 0.35
- Hit Rate@10 для товаров: > 0.25
- Revenue Lift: > 10%

## Инструменты и технологии

### ML Framework
- Python 3.8+
- scikit-learn, pandas, numpy
- TensorFlow/PyTorch для deep learning
- XGBoost, LightGBM для gradient boosting

### Рекомендательные системы
- Surprise (collaborative filtering)
- Implicit (matrix factorization)
- TensorFlow Recommenders

### Временные ряды
- Prophet (Facebook)
- statsmodels (ARIMA)
- sktime

### Валидация и мониторинг
- MLflow для экспериментов
- Weights & Biases для трекинга
- Prometheus + Grafana для мониторинга

## Этапы разработки

### Этап 1: Исследовательский анализ (1-2 недели)
- EDA датасета
- Анализ паттернов покупок
- Feature engineering
- Baseline модели

### Этап 2: Разработка моделей (2-3 недели)
- Реализация различных подходов
- Hyperparameter tuning
- Ensemble методы
- Валидация на исторических данных

### Этап 3: Тестирование и оптимизация (1-2 недели)
- A/B тестирование
- Оптимизация метрик
- Production-ready код
- Документация

### Этап 4: Внедрение (1 неделя)
- API для рекомендаций
- Мониторинг производительности
- Обновление моделей

## Критерии успеха

1. **Технические**: Достижение целевых метрик качества
2. **Бизнес**: Увеличение конверсии и выручки
3. **Пользовательский опыт**: Релевантные рекомендации
4. **Масштабируемость**: Возможность обработки растущего объема данных

## Дополнительные требования

- Код должен быть покрыт тестами (минимум 80%)
- Документация для всех функций и классов
- Логирование всех этапов обработки
- Возможность retraining модели на новых данных
- Мониторинг дрейфа данных и деградации модели
